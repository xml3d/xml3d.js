<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title>XML3D 5.0 Specification</title>
  <script src='http://www.w3.org/Tools/respec/respec-w3c-common' async class='remove'></script>
  <link rel="stylesheet" href="xml3d-spec.css">

  <script class='remove'>
    var respecConfig = {
      // specification status (e.g. WD, LCWD, NOTE, etc.). If in doubt use ED.
      specStatus: "unofficial",

      // the specification's short name, as in http://www.w3.org/TR/short-name/
      shortName: "xml3d",

      // if your specification has a subtitle that goes below the main
      // formal title, define it here
      subtitle: "Interactive 3D Graphics for the Web",

      // if you wish the publication date to be other than today, set this
      publishDate:  "",

      // if the specification's copyright date is a range of years, specify
      // the start date here:
      // copyrightStart: "2005",

      // if there is a previously published draft, uncomment this and set its YYYY-MM-DD date
      // and its maturity status
      // previousPublishDate:  "1977-03-15",
      // previousMaturity:  "WD",

      // if there a publicly available Editor's Draft, this is the link
      // edDraftURI: "http://dev.w3.org/2009/dap/ReSpec.js/documentation.html",
      previousURI: "http://www.xml3d.org/xml3d/specification/0.4.3/",

      // editors, add as many as you like
      // only "name" is required
      editors: [{
        name: "Kristian Sons"
      }],

      // authors, add as many as you like.
      // This is optional, uncomment if you have authors as well as editors.
      // only "name" is required. Same format as editors.

      authors: [{
        name: "Felix Klein",
        company: "Intel Visual Computing Institute",
        companyURL: "http://www.intel-vci.uni-saarland.de/"
      }, {
        name: "Kristian Sons", company: "DFKI", companyURL: "http://www.dfki.de/"
      }],

      // name of the WG
      wg: "Declarative 3D Community Group",

      // URI of the public WG page
      wgURI: "http://www.w3.org/community/declarative3d/",

      // name (without the @w3c.org) of the public mailing to which comments are due
      wgPublicList: "public-declarative3d",

      // URI of the patent status for this WG, for Rec-track documents
      // !!!! IMPORTANT !!!!
      // This is important for Rec-track documents, do not copy a patent URI from a random
      // document unless you know what you're doing. If in doubt ask your friendly neighbourhood
      // Team Contact.
      wgPatentURI: "http://www.w3.org/community/about/agreements/cla/"
    };
  </script>
</head>
<body>
<section id='abstract'>
</section>

<section>
  <h2>Concepts</h2>
  <section>
    <h3>Generic data model</h3>
  </section>
  <section>
    <h3>Predefined primitive types</h3>
  </section>
  <section>
    <h3>Predefined material models</h3>
  </section>
  <section>
    <h3>Predefined light models</h3>
    <section>
    <h2>Point Lights</h2>
    <p>URN: <code>urn:xml3d:light:point</code></p>
    <div class="attributes">Attributes:
     <table>
      <tbody><tr>
        <th>Name</th>
        <th>Type</th>
        <th>Default</th>
        <th>Description</th>
      </tr>
      <tr>
        <td>position</td>
        <td>float3</td>
        <td>0 0 0</td>
        <td>The position of the point light in object space</td>
      </tr>
      <tr>
        <td>attenuation</td>
        <td>float3</td>
        <td>0 0 1</td>
        <td>The attenuation of the point light given as its constant, linear, e.g quadratic component.</td>
      </tr>
      <tr>
        <td>intensity</td>
        <td>float3</td>
        <td>1 1 1</td>
        <td>The RGB intensity of the point light.</td>
      </tr>
      </tbody>
    </table>
    </div>
    <p>
    Point light sources emit light from a single point in space with a uniform distribution in all directions, i.e. omnidirectional.
    The position of the point light is defined by its <i>position</i> attribute and affected by the transformation of the light element that defines
    the occurrence of the point light. The orientation of the light element is not influencing the light.
    </p>
    </section>

    <section>
    <h2>Directional Lights</h2>
    <p>URN: <code>urn:xml3d:light:directional</code></p>
    <div class="attributes">Attributes:
      <table>
        <tbody>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Default</th>
          <th>Description</th>
        </tr>
        <tr>
          <td>direction</td>
          <td>float3</td>
          <td>0 0 -1</td>
          <td>The direction of the light in object space.</td>
        </tr>
        <tr>
          <td>intensity</td>
          <td>float3</td>
          <td>1 1 1</td>
          <td>The RGB intensity of the point light.</td>
        </tr>
        </tbody>
      </table>
      </div>
      <p>
     Directional light sources, also known as distant light sources, emit light along parallel rays from an infinite distance away. The direction the light sources
        emits from is defined by its <i>direction</i> attribute and affected by the transformation of the light element that defines
    the occurrence of the distant light. The position of the light element is not taken into account.
    </p>

      </section>

    <section>
    <h2>Spot Lights</h2>  <p>URN: <code>urn:xml3d:light:spot</code></p>
    <div class="attributes">Attributes:
      <table>
        <tbody>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Default</th>
          <th>Description</th>
        </tr>
        <tr>
          <td>position</td>
          <td>float3</td>
          <td>0 0 0</td>
          <td>The position of the point light in object space</td>
        </tr>
        <tr>
          <td>direction</td>
          <td>float3</td>
          <td>0 0 -1</td>
          <td>The direction of the light in object space.</td>
        </tr>
        <tr>
          <td>intensity</td>
          <td>float3</td>
          <td>1 1 1</td>
          <td>The <i>RGB</i> intensity of the directional light.</td>
        </tr>
        <tr>
          <td>attenuation</td>
          <td>float3</td>
          <td>0 0 1</td>
          <td>The attenuation of the point light given as its constant, linear, e.g quadratic component.</td>
        </tr>
        <tr>
          <td>falloffAngle</td>
          <td>float</td>
          <td>Math.PI/4</td>
          <td>Spot angle in radians. Controls the size of the outer cone of a spot light, i.e. the circular area a spot
            light covers.
          </td>
        </tr>
        <tr>
          <td>softness</td>
          <td>float</td>
          <td>0</td>
          <td>Softness of the spot light in the range [0;1].</td>
        </tr>
        </tbody>
      </table>
      </div>
      <p>
      Spot light source are a variation of point lights: Instead of emitting light omnidirectional, they emit light from their position in a cone of direction.
      The <i>fallOffAngle</i> attribute defines the size of the cone. Objects outside the cone defined by the <i>fallOffAngle</i> are not lit by the light source. The <i>softness</i>
      attribute defines the percentage of the cone in which the illumination ramps down from full to no illumination, i.e. a softness of 0 specifies a hard transition between full to no illumination and a softness of 1.0 a linear transition along the radius of the cone.
      </p>
      </section>
  </section>
</section>

<section>
  <h2>The elements of XML3D</h2>
  <section>
      <h3>Kinds of elements</h3>
      <section>
          <h4>Transformable elements</h4>
      </section>
      <section>
          <h4>Data elements</h4>
          <p>Data elements are the non-leaf nodes of an Xflow graph. They may contain any combination of data elements and <a href="#value-elements">value elements</a>. They may also reference
          other data elements through the <code>src</code> attribute using a standard HTML URI.</p>

          <p>The ultimate function of a graph of data elements is to provide data to a "sink".  Some data sinks in XML3D include the <a href="#the-mesh-element"><code>mesh</code></a> element, the
              <a href="#the-material-element"><code>material</code></a> element and the <a href="#the-view-element"><code>projection</code></a> attribute of the
              <a href="#the-view-element"><code>view</code></a> element. </p>

          <p>The ability to reference data elements makes it possible to share a common set of data between many different sinks. This saves memory and increases performance, as the data is also
          shared internally whenever possible. For example, a set of vertex positions may be shared between many instances of the same mesh using a different set of face indices each time. Internally
          these meshes will also share a common WebGL vertex position buffer:</p>
          <pre class="example highlight">
              &lt;data id="shared_positions"&gt;
                &lt;float3 name="position"&gt; 1.0 0.0 0.0 0.5 1.0 1.0 ... &lt;/float3&gt;
              &lt;/data&gt;
              &lt;mesh&gt;
                &lt;data src="#shared_positions"&gt;&lt;/data&gt;
                &lt;int name="index"&gt; 0 1 2 3 4 5 ... &lt;/int&gt;
              &lt;/mesh&gt;
              &lt;mesh&gt;
                &lt;data src="#shared_positions"&gt;&lt;/data&gt;
                &lt;int name="index"&gt; 3 4 5 0 1 2 ... &lt;/int&gt;
              &lt;/mesh&gt;
          </pre>


      </section>
      <section>
          <h4>Value elements</h4>
          <p>Value elements are the leaf nodes of an Xflow graph. They may not be nested and may not contain any non-text child elements. Data should be provided as a text node
              containing a space-separated list of values. The tag name determines how this data is interpreted:</p>
          <pre class="example highlight">
              &lt;bool&gt;1 0 0&lt;/bool&gt;     // an array of three boolean values
              &lt;float3&gt;1 0 0&lt;/float3&gt; // a single three-dimensional floating point vector
          </pre>

          <p>The <code>name</code> attribute of a value element acts as an ID for the data contained in this element. It may be referenced in XFlow operators or
              in material shaders. If two value elements with the same name are present in an XFlow data graph then the value nearest the top will replace any value
              nested deeper within the graph.</p>

          <p>In this example the value of the <code>color</code> field will be <code>1.0 0.0 0.0</code> when referencing <code>#my-data</code>.</p>
        <pre class='example highlight'>
            &lt;data id="my-data"&gt;
                &lt;float3 name="color"&gt;1.0 0.0 0.0&lt;/float3&gt;
                &lt;data&gt;
                    &lt;float3 name="color"&gt;1.0 1.0 1.0&lt;/float3&gt;
                &lt;/data&gt;
            &lt;/data&gt;
       </pre>

      </section>
      <section>
          <h4>Interactive elements</h4>
          <p>Interactive elements are those which are able to receive mouse event listeners. The list of available mouse event listeners is described in the
          <a href="#events">Events</a> section.</p>

          <p>In order to receive a mouse event an element must have a renderable object somewhere in its subtree for the user to interact with. When the user
          interacts with this object (eg. clicks on it) the relevant MouseEvent will be generated on the <a href="#the-mesh-element"><code>mesh</code></a> or
              <a href="#the-model-element"><code>model</code></a> element and then bubbled up the scene hierarchy. This will continue until the event reaches the
          <a href="#the-xml3d-element"><code>xml3d</code></a> element, or until <code>event.stopPropagation()</code> is called.</p>

          <p>In the following example, when clicking on the object in the scene corresponding to this <a href="#the-mesh-element"><code>mesh</code></a> element,
          both listeners will be triggered in the appropriate order:</p>

           <pre class='example highlight'>
            &lt;group onmousedown="myMouseDownListener(event)"&gt;
                &lt;group&gt;
                    &lt;mesh onmouseup="myMouseUpListener(event)" type="triangles"&gt;&lt;/mesh&gt;
                &lt;/group&gt;
            &lt;/group&gt;
           </pre>

          <div class="note">Object visibility may affect whether or not mouse event listeners are triggered. See the <a href="#css-properties">CSS Properties</a>
          section on visibility for more information.</div>

      </section>
  </section>

  <section>
    <h3>The root element</h3>
    <section>
      <h4>The <code>xml3d</code> element</h4>
        <dl class='element'>
        </dl>

      <dl title='interface XML3DXml3dElement : HTMLElement' class='idl'>
        <dt>attribute unsigned long width</dt>
        <dd>Horizontal dimension</dd>
        <dt>attribute unsigned long height</dt>
        <dd>Vertical dimension</dd>
        <dt>readonly attribute boolean complete</dt>
        <dd>Returns true if all resources of the root element has been completely downloaded and rendered; otherwise,
          returns false.
        </dd>

        <dt>attribute DOMString activeview</dt>
        <dd>The activeview IDL attribute must reflect the respective content attribute of the same name.</dd>

        <dt>HTMLElement? getElementByPoint()</dt>
        <dd>
            Returns the element at the point with <b>window</b> coordinates x,y if there is a scene element; otherwise, returns
            null.
            <dl class='parameters'>
                <dt>unsigned long x</dt>
                <dd>The x coordinate relative to the top left of the browser window</dd>
                <dt>unsigned long y</dt>
                <dd>The y coordinate relative to the top left of the browser window</dd>
                <dt>optional XML3DVec3 hitPoint</dt>
                <dd>If provided this vector will be filled with the position of the hit point in world space.</dd>
                <dt>optional XML3DVec3 hitNormal</dt>
                <dd>If provided this vector will be filled with the normal of the hit point in world space.</dd>
            </dl>
        </dd>

        <dt>HTMLElement? getElementByRay()</dt>
        <dd>Returns the first element that intersects with ray if the ray intersects with a a scene element; otherwise,
          returns null.
            <dl class='parameters'>
                <dt>XML3DRay ray</dt>
                <dd></dd>
                <dt>optional XML3DVec3 hitPoint</dt>
                <dd>If provided this vector will be filled with the position of the hit point in world space.</dd>
                <dt>optional XML3DVec3 hitNormal</dt>
                <dd>If provided this vector will be filled with the normal of the hit point in world space.</dd>
            </dl>
        </dd>

        <dt>XML3DBox getLocalBoundingBox()</dt>
        <dd>Returns the bounding box of the scene. Because the XML3D element is the root element the bounding box will be in world space by definition.</dd>

        <dt>XML3DBox getWorldBoundingBox()</dt>
        <dd>Returns the bounding box of the scene in world space.</dd>

        <dt>XML3DRay generateRay()</dt>
        <dd>
            Uses <a href="https://github.com/fintler/webgl-unproject">WebGL unProject</a> to generate a new XML3DRay from the given x,y <b>window</b> coordinates.
            <dl class='parameters'>
                <dt>unsigned long x</dt>
                <dd>The x coordinate relative to the top left of the browser window</dd>
                <dt>unsigned long y</dt>
                <dd>The y coordinate relative to the top left of the browser window</dd>
            </dl>
        </dd>

          <dt>attribute Function onframedrawn</dt>
          <dd>Event listener to be executed whenever a new frame has been drawn. Is passed a <a>FrameDrawn</a> event.
          </dd>


      </dl>
    </section>
  </section>

  <section>
    <h3>Scene elements</h3>
    <section>
      <h4>The <code>group</code> element</h4>
        <dl class='element'>
            <dt>Categories:</dt>
            <dd><a href="#interactive-elements">Interactive element</a></dd>
            <dd><a href="#transformable-elements">Transformable element</a></dd>
        </dl>
        <dl title='interface XML3DGroupElement : HTMLElement' class='idl'>
            <dt>attribute DOMString transform</dt>
            <dd>Accepts a URI fragment referencing a <a>transform</a> element. Alternatively a transformation may be defined
            with CSS through the style attribute.</dd>
            <dt>attribute DOMString material</dt>
            <dd>Accepts a URI fragment referencing a <a>material</a> element. Material is inherited from the parent group if
            this attribute is not present.</dd>
            <dt>attribute boolean visible</dt>
            <dd>A value of "false" will prevent this group being drawn to the canvas. Visibility is inherited from the parent group
            if this attribute is not present. </dd>
            <dt>XML3DMatrix getWorldMatrix()</dt>
            <dd>Returns the transformation matrix of this group element in world space (includes parent transformations).
            </dd>
            <dt>XML3DMatrix getLocalMatrix()</dt>
            <dd>Returns the local transformation matrix of this group element (does not include parent transformations).
            </dd>
            <dt>XML3DBox getLocalBoundingBox()</dt>
            <dd>Returns the bounding box of this group in its local transformation space. </dd>

            <dt>XML3DBox getWorldBoundingBox()</dt>
            <dd>Returns the bounding box of this group in world space.</dd>
        </dl>
    </section>
    <section>
      <h4>The <code>view</code> element</h4>
        <dl class='element'>
            <dt>Categories:</dt>
            <dd><a href="#transformable-elements">Transformable element</a></dd>
        </dl>
        <dl title='interface XML3DViewElement : HTMLElement' class='idl'>
            <dt>attribute XML3DVec3 position</dt>
            <dd>The position of the camera in world space</dd>

            <dt>attribute XML3DRotation orientation</dt>
            <dd>The orientation (rotation) of the camera</dd>

            <dt>attribute float fieldofview</dt>
            <dd>The <b>vertical</b> field of view of this camera, expressed in radians.
            </dd>

            <dt>attribute DOMString projection</dt>
            <dd>Overrides the camera's internal projection matrix. The attribute should contain a URI to a data element
                supplying a float4x4 matrix named "projection". This can be used to, for example, create an orthographic camera. </dd>

            <dt>XML3DMatrix getWorldMatrix()</dt>
            <dd>Returns the transformation matrix of this view element in world space.
            </dd>

            <dt>void setUpVector(XML3DVec3 direction)</dt>
            <dd>Change the up vector of the camera. This method changes the current orientation. The up vector will be
                lost if the orientation is explicitly set at a later time.
            </dd>

            <dt>void setDirection(XML3DVec3 direction)</dt>
            <dd>Change the orientation of the camera to look along the given direction vector.
            </dd>

            <dt>XML3DVec3 getDirection()</dt>
            <dd>Returns the current direction of the camera, which is extracted from the orientation.
            </dd>

            <dt>XML3DVec3 getUpVector()</dt>
            <dd>Returns the current up vector of the camera, which is extracted from the orientation.
            </dd>

            <dt>XML3DMatrix getViewMatrix()</dt>
            <dd>Returns the view matrix of the camera (the matrix used to transform from world to view space).
            </dd>

            <dt>void lookAt(XML3DVec3 point)</dt>
            <dd>Change the orientation of the camera to look at the given point.
            </dd>
        </dl>
    </section>
    <section>
      <h4>The <code>light</code> element</h4>
        <dl class='element'>
            <dt>Categories:</dt>
            <dd><a href="#data-elements">Data element</a></dd>
            <dd><a href="#transformable-elements">Transformable element</a></dd>
        </dl>
      <p>The <span class="element-name">light</span> element defines a light source in the scene that emits light based on the light model defined by
      the <a href="#attr-light-model" class="internalDFN">model</a> attribute. The light uses the <a href="h-generic-data-model">generic data model</a> to define the parameters of the referenced material model.
      The coordinate system of the <span class="element-name">light</span> element defines the base coordinate system for the light. However, the final position and direction of the light source can altered by
      specific parameters of the light model.
      </p>
      <p>A light affects all geometry elements within the same scene, i.e. with the same xml3d element as ancestor.</p>
      <div class="issue">Do we need means for or at least a note about filtering the affected elements?</div>
      <p>
      The light model used by the light is defined by the  <dfn id="attr-light-model">model</dfn> attribute.
      If the <code>model</code> attribute is present, it must contain a valid non-empty URN referencing one of the <a href="#predefined-light-models">predefined light models</a>.
      If the URN is empty or references an unknown light model, or if the <code>model</code> attribute is not present, the <a href="#predefined-light-models">directional light</a> model is used.
      <div class="issue">Should we ignore unknown light models instead?</div>
      <div class="note">Currently, XML3D supports predefined light models only. However, similar to materials, we envisage programmable light models for future versions of XML3D.
      </div>


      <p>This example illustrates the use of a single light source based on the predefined directional light model using its default parameters:</p>
       <pre class='example highlight'>
&lt;light&gt;&lt;/light&gt;
       </pre>
      Since no direction for the light source is specified for the light source, the default direction <code>0 0 -1</code> (along the negative z axis) is transformed by the global
      coordinate system of the light element.

     <p>This example illustrates the use of a single light source based on the predefined point light model:</p>
       <pre class='example highlight'>
&lt;light model=&quot;urn:xml3d:light:point&quot;&gt;
  &lt;float3 name=&quot;intensity&quot;&gt;0.8 0.8 1&lt;/float3&gt;
&lt;/light&gt;
       </pre>


       <dl title='interface XML3DLightElement : XML3DDataElement' class='idl'>
        <dt>attribute DOMString model</dt>
        <dd>The <code>model</code> IDL attribute must reflect the <a href="#attr-light-model" class="internalDFN">model</a> content attribute.</dd>
      </dl>
      </p>
    </section>
    <section>
      <h4>The <code>mesh</code> element</h4>
        <dl class='element'>
            <dt>Categories:</dt>
            <dd><a href="#data-elements">Data element</a></dd>
            <dd><a href="#interactive-elements">Interactive element</a></dd>
            <dd><a href="#transformable-elements">Transformable element</a></dd>
        </dl>

        <p>A mesh represents a single renderable object in the scene. To be drawn correctly a mesh must either inherit a
            <a href="#the-material-element"><code>material</code></a> from a parent element or assign its own through the <code>material</code> attribute.</p>

        <div class="note">A mesh can only be assigned a single material. Models that contain multiple materials will have to be broken down into separate meshes.</div>

        <p>The simplest way to define a mesh is to include its data directly in the <code>mesh</code> element:</p>

        <pre class='example highlight'>
            &lt;mesh type="triangles" material="#myMaterial"&gt;
                &lt;int name="index"&gt;0 1 2 ... &lt;/int&gt;
                &lt;float3 name="position"&gt;1.0 0.0 0.0 ... &lt;/float3&gt;
                &lt;float3 name="normal"&gt;0.0 1.0 0.0 ... &lt;/float3&gt;
            &lt;/mesh&gt;
        </pre>

        <p>However it's usually a good idea to reference this data instead, either in the same document or in an external document as shown below:</p>

        <pre class='example highlight'>
            &lt;!-- myDataElement is the id of a data element containing the mesh data --&gt;
            &lt;mesh src="myMesh.xml#myDataElement" type="triangles" material="#myMaterial"&gt;&lt;/mesh&gt;
        </pre>

        <p>Each entry in the mesh data is passed on to the material shader in the form of a vertex attribute. A mesh must <i>always</i> supply at least a
        <code>position</code> entry, any others are optional but may be required by a material in order to be rendered properly (eg. <code>normal</code> in
        conjunction with the predefined <code>phong</code> material). </p>

        <p>As with any <a href="#data-elements">data element</a>, a mesh may override certain entries or supply its own. This applies even to material entries:</p>

        <pre class='example highlight'>
            &lt;!-- This mesh will be rendered with a blue diffuseColor even though the material specifies a red one --&gt;
            &lt;mesh src="myMesh.xml#myDataElement" type="triangles" material="#myRedMaterial"&gt;
                &lt;float3 name="diffuseColor"&gt;0.0 0.0 1.0&lt;float3&gt;
            &lt;/mesh&gt;
        </pre>

        <dl title='interface XML3DMeshElement : HTMLElement' class='idl'>
            <dt>attribute DOMString type</dt>
            <dd>The primitive type that this mesh uses. Supported values are <code>triangles</code>, <code>tristrips</code>,
                <code>points</code>, <code>lines</code> and <code>linestrips</code>.</dd>

            <dt>attribute DOMString src</dt>
            <dd>URI reference to another data element containing the data for this mesh. Can be a reference to an external document.</dd>

            <dt>attribute DOMString material</dt>
            <dd>URI reference to a <a href="#the-material-element"><code>material</code></a> element.</dd>

            <dt>attribute DOMString transform</dt>
            <dd>URI reference to a <a href="#the-transform-element"><code>transform</code></a> element.</dd>

            <dt>XML3DDataResult getResult(Array filter)</dt>
            <dd>Returns a XML3DDataResult object containing the data for the fields requested by the given filter, eg.
                <code>["position", "index", "normal"]</code>. This is useful for accessing the mesh data directly through JavaScript.</dd>

            <dt>Array getOutputNames()</dt>
            <dd>Returns the names of the data fields available to this mesh node. </dd>

            <dt>XML3DMatrix getWorldMatrix()</dt>
            <dd>Returns the transformation matrix of this mesh element in world space (includes parent transformations).
            </dd>
            <dt>XML3DMatrix getLocalMatrix()</dt>
            <dd>Returns the local transformation matrix of this mesh element (does not include parent transformations).
            </dd>
            <dt>XML3DBox getLocalBoundingBox()</dt>
            <dd>Returns the bounding box of this mesh in object space, without any transformations applied. </dd>

            <dt>XML3DBox getWorldBoundingBox()</dt>
            <dd>Returns the bounding box of this mesh in world space.</dd>
        </dl>
    </section>
      <section>
      <h4>The <code>model</code> element</h4>
        <dl class='element'>
            <dt>Categories:</dt>
            <dd><a href="#data-elements">Data element</a></dd>
            <dd><a href="#interactive-elements">Interactive element</a></dd>
            <dd><a href="#transformable-elements">Transformable element</a></dd>
        </dl>
          <p>A model is an instantiation of an <a href="the-asset-element"><code>asset</code></a>. This is useful for rendering complex objects
              with many individual meshes or materials. Not only is it easier to insert a single <code>model</code> element into the DOM, it's also much
              more efficient. </p>

          <p>When referencing an external file the URI <i>must</i> contain the id of the <a href="the-asset-element"><code>asset</code></a> element to
          be instantiated:</p>

          <pre class='example highlight'>
            &lt;model src="myExternalAsset.xml#myAsset"&gt;&lt;/model&gt;
          </pre>

          <p>A model may override data inside the Asset by specifying the <a href="#the-assetmesh-element"><code>assetmesh</code></a> or
              <a href="#the-assetdata-element"><code>assetdata</code></a> element that should be overwritten. For example, to change the material
          of a mesh inside the Asset named "hat" we would define our model tag as follows:</p>

          <pre class='example highlight'>
            &lt;model src="myExternalAsset.xml#myAsset"&gt;
               &lt;assetmesh name="hat" material="#aNewMaterialDefinedLocally"&gt;&lt;/assetmesh&gt;
            &lt;/model&gt;
          </pre>

          This behavior is especially useful in driving animations inside the instantiated asset. Each instance of the <code>model</code> element can have its
          own animation state, even if all reference the same asset. Typically this is done by exposing the animation key through its own <code>assetdata</code>, which
          is then overwritten in the <code>model</code>:

          <pre class='example highlight'>
            &lt;!-- Assuming "myAsset" contains an assetdata element with name "animation" --&gt;
            &lt;model src="myExternalAsset.xml#myAsset"&gt;
               &lt;assetdata name="animation"&gt;
                &lt;float id="animation_key" name="key"&gt;1.0&lt;/float&gt;
              &lt;/assetdata&gt;
            &lt;/model&gt;
          </pre>

          By changing the value of the <code>animation_key</code> through JavaScript we can now control the model's animation state.

        <dl title='interface XML3DModelElement : HTMLElement' class='idl'>
            <dt>attribute DOMString src</dt>
            <dd>URI reference to an <a href="#the-asset-element"><code>asset</code></a> element that this <code>model</code> should instantiate.</dd>

            <dt>attribute DOMString material</dt>
            <dd>URI reference to a <a href="#the-material-element"><code>material</code></a> element. This material will only be used for
            objects that do not define their own material inside the <code>asset</code>.</dd>

            <dt>attribute DOMString transform</dt>
            <dd>URI reference to a <a href="#the-transform-element"><code>transform</code></a> element.</dd>

            <dt>XML3DMatrix getWorldMatrix()</dt>
            <dd>Returns the transformation matrix of this model in world space, including parent transformations.
            </dd>

            <dt>XML3DBox getLocalBoundingBox()</dt>
            <dd>Returns the bounding box of this model without any parent transformations applied.</dd>

            <dt>XML3DBox getWorldBoundingBox()</dt>
            <dd>Returns the bounding box of this model in world space, including parent transformations.</dd>
        </dl>
    </section>
  </section>

  <section>
    <h3>Definition Areas</h3>
    <section>
      <h4>The <code>defs</code> element</h4>
        <dl class='element'>
        </dl>
    </section>
  </section>

  <section>
    <h3>Property elements</h3>
    <section>
      <h4>The <code>material</code> element</h4>
        <dl class='element'>
            <dt>Categories:</dt>
            <dd><a href="#data-elements">Data element</a></dd>
        </dl>
      <p>A material describes the surface shading of an object. Materials are defined using a <span class="element-name">material</span>
      element and then
      referenced by the <a href="#dfn-material-property" class="internalDFN">material</a> property on a given <a href="#scene-elements">scene
      element</a> to indicate that the
      given element shall be shaded using the referenced material. Multiple scene elements can share a material.
      The material uses the generic data model to define the parameters of the referenced material model.
      Note that graphics elements can override the parameters defined in the material element. Hence, the parameters in
      the material element can be considered as default materials.</p>


      <p>
      The material model used by the material is defined by the <dfn id="attr-material-script">script</dfn> attribute.
      The <code>script</code> attribute must be present, and must contain a valid non-empty URL referencing either a <a href="#predefined-material-models">predefined material model</a> or
      a scripted material model, e.g. using shade.js.
      </p>
      <p>Here is a simple example for a material based on the predefined phong material model:</p>
       <pre class='example highlight'>
&lt;material script=&quot;urn:xml3d:shader:phong&quot;&gt;
  &lt;float3 name=&quot;diffuseColor&quot;&gt;0 0 1&lt;/float3&gt;
  &lt;texture name=&quot;diffuseTexture&quot;&gt;
    &lt;img src=&quot;../stone.jpg&quot;/&gt;
  &lt;/texture&gt;
&lt;/material&gt;
</pre>

      <dl title='interface XML3DMaterialElement : XML3DDataElement' class='idl'>
        <dt>attribute DOMString script</dt>
        <dd>The <code>script</code> IDL attribute must reflect the <a href="#attr-material-script" class="internalDFN">script</a> content attribute.</dd>
      </dl>
    </section>
    <section>
      <h4>The <code>transform</code> element</h4>
        <dl title='interface XML3DTransformElement : HTMLElement' class='idl'>
            <dt>attribute XML3DRotation scaleorientation</dt>
            <dd>The orientation on which to apply the scaling factor supplied by the IDL attribute <i>scale</i>.</dd>
        </dl>
    </section>
  </section>

  <section>
    <h3>Data and dataflow elements</h3>
    <section>
      <h4>The <code>data</code> element</h4>
        <dl class='element'>
            <dt>Categories:</dt>
            <dd><a href="#data-elements">Data element</a></dd>
        </dl>
       <dl title='interface XML3DDataElement : HTMLElement' class='idl'>
        <dt>attribute DOMString script</dt>
        <dd>The <code>script</code> IDL attribute must reflect the <a href="#attr-material-script" class="internalDFN">script</a> content attribute.</dd>
      </dl>
    </section>
    <section>
        <h4>The <code>float</code>, <code>float2</code>, <code>float3</code>, <code>float4</code>, and
            <code>float4x4</code> elements</h4>
        <dl class='element'>
            <dt>Categories:</dt>
            <dd><a href="#value-elements">Value element</a></dd>
        </dl>
        <p>The <code>float*</code> elements hold a space separated list of floating point values. The tag name determines how this data is interpreted, ie. a <code>float2</code> element
            will interpret the data as an array of 2D vectors while a <code>float4x4</code> element will interpret it as an array of 4x4 matrices. </p>

        <dl title='interface XML3DFloatValueElement : HTMLElement' class='idl'>
            <dt>attribute DOMString name</dt>
            <dd>The name of the value element. A good name should be a semantic description of the data that this element holds.</dd>
            <dt>attribute boolean param</dt>
            <dd>Marks this value as one to be supplied by a different data element. Value elements with the <code>param</code> attribute are
                the only value elements that may be empty, all others must contain data. See the <a href="#the-dataflow-element" class="internalDFN">dataflow</a>
                element for example usage.</dd>
            <dt>attribute float key</dt>
            <dd>A keyframe value to assist in defining animated values. A script may, for example, interpolate the data between successive keys.</dd>

            <dt>void setScriptValue(Float32Array value)</dt>
            <dd>
                A high performance setter to set the data of this value element directly through JavaScript.
            </dd>
        </dl>


    </section>
    <section>
      <h4>The <code>int</code> and <code>int4</code> elements</h4>
        <dl class='element'>
            <dt>Categories:</dt>
            <dd><a href="#value-elements">Value element</a></dd>
        </dl>
        <p>The <code>int*</code> elements hold a space separated list of integer values. The tag name determines how this data is interpreted, ie. an <code>int4</code> element
            will interpret the data as an array of 4-component integer vectors. </p>
        <dl title='interface XML3DIntValueElement : HTMLElement' class='idl'>
            <dt>attribute DOMString name</dt>
            <dd>The name of the value element. A good name should be a semantic description of the data that this element holds.</dd>
            <dt>attribute boolean param</dt>
            <dd>Marks this value as one to be supplied by a different data element. Value elements with the <code>param</code> attribute are
                the only value elements that may be empty, all others must contain data. See the <a href="#the-dataflow-element" class="internalDFN">dataflow</a>
                element for example usage.</dd>
            <dt>attribute float key</dt>
            <dd>A keyframe value to assist in defining animated values. A script may, for example, interpolate the data between successive keys.</dd>

            <dt>void setScriptValue(Int16Array value)</dt>
            <dd>
                A high performance setter to set the data of this value element directly through JavaScript.
            </dd>
        </dl>
    </section>
    <section>
      <h4>The <code>bool</code> element</h4>
        <dl class='element'>
            <dt>Categories:</dt>
            <dd><a href="#value-elements">Value element</a></dd>
        </dl>
        <p>The <code>bool</code> element holds a space separated list of boolean values. The values may be given in string form (<code>true/false</code>) or as integers (<code>1/0</code>). </p>

        <dl title='interface XML3DBoolValueElement : HTMLElement' class='idl'>
            <dt>attribute DOMString name</dt>
            <dd>The name of the value element. A good name should be a semantic description of the data that this element holds.</dd>
            <dt>attribute boolean param</dt>
            <dd>Marks this value as one to be supplied by a different data element. Value elements with the <code>param</code> attribute are
                the only value elements that may be empty, all others must contain data. See the <a href="#the-dataflow-element" class="internalDFN">dataflow</a>
                element for example usage.</dd>
            <dt>attribute float key</dt>
            <dd>A keyframe value to assist in defining animated values. A script may, for example, interpolate the data between successive keys.</dd>

            <dt>void setScriptValue(Int16Array value)</dt>
            <dd>
                A high performance setter to set the data of this value element directly through JavaScript.
            </dd>
        </dl>
    </section>






    <!-- texture element -->
    <section>
      <h4>The <code>texture</code> element</h4>
      <dl class='element'>
        <dt>Categories:</dt>
        <dd><a href="#value-elements">Value element</a></dd>
        <dt>Content model:</dt>
        <dd>One or more <code>img</code>, <code>video</code>, or <code>canvas</code> elements</dd>
      </dl>

      The texture element represents a texture that can be used as parameter for materials or as input for generic
      dataflow processing.
      The image data of the texture is defined by its children.
      The texture element's attributes determine how samples are derived from the image.
      <p class="note">
        Texture sampling attributes configure fixed-function sampling methods on the graphics hardware.
        Thus these attributes qualify as CSS properties. We have abstained from using CSS properties because we
        currently cannot define custom CSS properties.
      </p>


      <div>The <dfn id="attr-texture-wrap">wrap</dfn> attribute controls the texture access if the provided texture
        coordinates are outside range [0;1]. The wrap attribute is a combined enumerated attribute.
        A valid wrap value is a string that matches the <code>wrap</code> production of the following form:
      <pre>
        wrap := &lt;wrap-mode&gt; &lt;wrap-mode&gt;?
        wrap-mode := repeat | clamp
      </pre>
        If two <code>wrap-mode</code> values are given, then the first value defines the wrap mode for s coordinates and
        the second for t coordinates. Otherwise the wrap mode is applied in all directions.
        The wrap-mode values correspond to CLAMP_TO_EDGE and REPEAT in OpenGL.

      </div>
      <br>

      <div>The <dfn id="attr-texture-filter">filter</dfn> attribute controls the filtering of the texture, i.e. which
        texture pixel access function is used. The <code>wrap</code> attribute is a combined enumerated attribute.
        A valid filter value is a string that matches the filter production of the following form:
      <pre>
        filter := (&lt;min-filter-mode&gt; &lt;mag-filter-mode&gt;) | &lt;mag-filter-mode&gt;
        min-filter-mode := nearest | linear | nearest-mipmap-nearest | nearest-mipmap-linear | linear-mipmap-nearest | linear-mipmap-linear
        mag-filter-mode := nearest | linear
      </pre>
        If only the <code>mag-filter-mode</code> is given, the specified function is used for both, minifying and
        magnification. Otherwise, the <code>min-filter-mode</code> is used for minifying and the
        <code>mag-filter-mode</code> is used for magnification.
        The functions specified by the filter modes correspond to those in OpenGL (NEAREST, LINEAR,
        NEAREST_MIPMAP_NEAREST, NEAREST_MIPMAP_LINEAR, LINEAR_MIPMAP_NEAREST, and LINEAR_MIPMAP_LINEAR).
        The default filter mode is "linear-mipmap-linear linear".
      </div>

      <p class="note">
        xml3d.js will automatically resize textures to the nearest power-of-two dimensions when the texture wrap mode is
        set to "repeat" or filtermin is set to anything other than "nearest" or
        "linear". See <a
        href="https://www.khronos.org/webgl/wiki/WebGL_and_OpenGL_Differences#Non-Power_of_Two_Texture_Support">WebGL
        limitations</a> for more information.
      </p>

      Here is an example of using the <code>wrap</code> and <code>filter</code> attributes to configure the sampling of a texture:
      <pre class="example highlight">
&lt;texture name=&quot;diffuseTexture&quot; wrap=&quot;repeat clamp&quot; filter=&quot;nearest linear&quot;&gt;
  &lt;img src=&quot;../stone.jpg&quot;/&gt;
&lt;/texture&gt;
      </pre>

       The <dfn id="attr-texture-type">type</dfn>  attribute is an <a href="http://www.w3.org/TR/html5/single-page.html#enumerated-attribute">enumerated attribute</a> with four states with three explicit keywords:
       <dl>
         <dt>The <dfn id="attr-texture-type-1d">1D</dfn> keyword, which maps to the <i>1D</i> state</dt>
         <dd>The 1D state means the children elements define a 1D texture each.</dt>
         <dt>The <dfn id="attr-texture-type-2d">2D</dfn> keyword, which maps to the <i>2D</i> state</dt>
         <dd>The 2D state means the children elements defines a 2D texture.</dd>
         <dt>The <dfn id="attr-texture-type-3d">3D</dfn> keyword, which maps to the <i>3D</i> state</dt>
         <dd>The 3D state means the children elements defines a 3D texture.</dd>
         <dt>The <i>auto</i> state</dt>
         <dd>The type of the texture is determined by the system based on the texture's children elements.</dd>
       </dl>
       <p>The <code><a href="#attr-texture-type" class="internalDFN">type</a></code> attribute's <i>missing value default</i> is the <i>auto</i> state.</p>


      <dl title='interface XML3DTextureElement : HTMLElement' class='idl'>
        <dt>attribute DOMString wrap</dt>
        <dd>The <code>wrap</code> IDL attribute must reflect the respective content attribute of the same name.</dd>
        <dt>attribute DOMString filter</dt>
        <dd>The <code>filter</code> IDL attribute must reflect the respective content attribute of the same name.</dd>
        <dt>attribute DOMString name</dt>
        <dd>Required. The name of the texture as defined by the material shader.</dd>
        <dt>attribute boolean param</dt>
        <dd>If this element appears inside a DataFlow element the param attribute will mark it as a parameter to be
          supplied by the Data element referencing the DataFlow.
        </dd>
        <dt>attribute DOMString type</dt>
        <dd>The <code>type</code></dfn> IDL attribute must reflect the content attribute of the same name, <a href="http://www.w3.org/TR/html5/single-page.html#limited-to-only-known-values">limited to only known values</a>.</dd>
      </dl>
    </section>

    <section>
      <h4>The <code>dataflow</code> element</h4>
        <dl class='element'>
            <dt>Categories:</dt>
            <dd><a href="#data-elements">Data element</a></dd>
        </dl>
    </section>
  </section>

  <section>
    <h3>Assets</h3>
    <section>
      <h4>The <code>asset</code> element</h4>
        <dl class='element'>
        </dl>
    </section>
    <section>
      <h4>The <code>assetdata</code> element</h4>
        <dl class='element'>
            <dt>Categories:</dt>
            <dd><a href="#data-elements">Data element</a></dd>
        </dl>
    </section>
    <section>
      <h4>The <code>assetmesh</code> element</h4>
        <dl class='element'>
            <dt>Categories:</dt>
            <dd><a href="#data-elements">Data element</a></dd>
        </dl>
    </section>
  </section>

</section>

<section>
  <h2>Datatypes</h2>
  <section>
    <h3>XML3DVec3</h3>
    <dl title='interface XML3DVec3' class='idl'>
      <dt>attribute float x</dt>
      <dd></dd>
      <dt>attribute float y</dt>
      <dd></dd>
      <dt>attribute float z</dt>
      <dd></dd>
    </dl>
  </section>
  <section>
    <h3>XML3DRotation</h3>
  </section>
  <section>
    <h3>XML3DMatrix</h3>
  </section>
  <section>
    <h3>XML3DBox</h3>
    XML3DBox defines an axis-aligned box, i.e. its faces are along the X, Y, Z axis.
    <dl title='interface XML3DBox' class='idl'>
      <dt>attribute XML3DVec3 min</dt>
      <dd></dd>
      <dt>attribute XML3DVec3 max</dt>
      <dd></dd>
    </dl>
  </section>
  <section>
    <h3>XML3DRay</h3>
  </section>
</section>

<section>
  <h2>CSS Properties</h2>
</section>

<section>
    <h2>Content-Types</h2>
    <p>XML3D specifies the following content-types for external resources:</p>
    <pre>
        JSON mesh file     model/vnd.xml3d.mesh+json

        XML mesh file      model/vnd.xml3d.mesh+xml

        XML asset file     model/vnd.xml3d.model+xml

        BLAST binary       model/vnd.xml3d.[model|mesh]+blast
    </pre>
    <p>XML3D will set the appropriate <code>Accept</code> header when requesting these resources. The response should include a
    <code>Content-Type</code> header with the same content-type <b>or</b> the appropriate standard type
    <code>application/json</code>, <code>application/xml</code> or <code>application/octet-stream</code>. </p>
    <div class="note">A response with no <code>Content-Type</code> header at all <em>will not be handled</em> and will generate an error message.</div>
</section>


<section>
  <h2>Events</h2>
    <section>
        <h3>Mouse and Keyboard Events</h3>
        The following event listeners are available on all <a href="#interactive-elements">interactive elements</a>:
            <ul>
                <li>onclick</li>
                <li>ondblclick</li>
                <li>onmousedown</li>
                <li>onmouseup</li>
                <li>onmouseover</li>
                <li>onmousemove</li>
                <li>onmouseout</li>
                <li>onkeypress</li>
                <li>onkeydown</li>
                <li>onkeyup</li>
            </ul>
        The event received by these listeners is a standard HTML5 <a href="http://www.w3.org/TR/DOM-Level-3-Events/#events-mouseevents">MouseEvent</a>
        or <a href="http://www.w3.org/TR/DOM-Level-3-Events/#events-keyboardevents">KeyboardEvent</a> respectively. As in normal HTML, event listeners
        may be added to the element through an appropriate <code>on[eventName]</code> attribute or through JavaScript using <code>element.addEventListener(...)</code>.
        <div class="note">Listeners registered through an attribute must use the following format: <code>"myListenerFunction(event)"</code></div>
    </section>
    <section>
        <h3>FrameDrawn</h3>
        <dl title='interface FrameDrawn : CustomEvent' class='idl'>
            <dt>attribute float detail.timeStart</dt>
            <dd>The system time at the beginning of the frame draw.</dd>
            <dt>attribute float detail.timeEnd</dt>
            <dd>The system time at the end of the frame draw.</dd>
            <dt>attribute float detail.renderTimeInMilliseconds</dt>
            <dd>The total time taken to render this frame. Includes time spent updating the scene state and any XFlow data processing. </dd>
            <dt>attribute int detail.count.objects</dt>
            <dd>The total number of distinct meshes drawn in this frame after applying frustum culling (if enabled).</dd>
            <dt>attribute int detail.count.primitives</dt>
            <dd>The total number of primitives drawn in this frame after applying frustum culling (if enabled).</dd>
        </dl>
    </section>
</section>

</body>
</html>
